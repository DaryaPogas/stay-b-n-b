<h1>Bookings for "<%= @listing.title %>"</h1>

<% if logged_in? %>
  <p><%= link_to "New Booking", new_listing_booking_path(@listing), class:"btn" %></p>
<% end %>

<% if @bookings.any? %>
<table>
    <thead>
      <tr><th>Guest</th><th>Start</th><th>End</th><th>Nights</th><th></th></tr>
    </thead>
    <tbody>
      <% @bookings.each do |b| %>
        <tr>
          <td><%= b.user&.name %></td>
          <td><%= b.start_date %></td>
          <td><%= b.end_date %></td>
          <td><%= (b.end_date - b.start_date).to_i rescue "" %></td>
          <td>
            <% if logged_in? && b.user_id == current_user&.id %>
              <%= button_to "Cancel", listing_booking_path(@listing, b), method: :delete, class: "btn-ghost",
                    data: { confirm: "Cancel this booking?" } %>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p class="muted">No bookings yet.</p>
<% end %>

<p><%= link_to "Back to listing", listing_path(@listing), class: "btn-ghost" %></p>
